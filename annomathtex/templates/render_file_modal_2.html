<!DOCTYPE html>
<html>
<head>
  <script
    src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js">
  </script>
  <style>
    body {font-family: Arial, Helvetica, sans-serif;}

    .data {
    display: none;
    }

    /* The Modal (background) */
    .modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    padding-top: 100px; /* Location of the box */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
    background-color: #fefefe;
    margin: auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    }

    /* The Close Button */
    .close {
    color: #aaaaaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    }

    .close:hover,
    .close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
    }

    table {
      font-family: arial, sans-serif;
      border-collapse: collapse;
      width: 100%;
    }

    td, th {
      border: 1px solid #dddddd;
      text-align: left;
      padding: 8px;
    }

    tr:nth-child(even) {
      background-color: #dddddd;
    }

  </style>

</head>

<body>
<form method="POST" id="post-form">
    {% csrf_token %}
    <div name="tested" id="tested">Testesteste</div>
    <input type="submit" class="tiny button" name="post-form-submit">
    <button type="submit" name="post-form-submit2">Upload</button>
</form>

<div id="foo" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <span class="close" id="span">&times;</span>
    <!--<p>Put information about the identifier here!</p>-->
    <button id="highlightBtn" onclick="highlightToken()">HIGHLIGHT</button>
    <button id="unHighlightBtn" onclick="unHighlightToken()">UNHIGHLIGHT</button>
    <p id="placeholder"></p>
    <table>
      <tr>
        <th>foo</th>
        <th>bar</th>
        <th>foobar</th>
      </tr>
      <tr>
        <td>Alfreds Futterkiste</td>
        <td>Maria Anders</td>
        <td>Germany</td>
      </tr>
      <tr>
        <td>Centro comercial Moctezuma</td>
        <td>Francisco Chang</td>
        <td>Mexico</td>
      </tr>
      <tr>
        <td>Ernst Handel</td>
        <td>Roland Mendel</td>
        <td>Austria</td>
      </tr>
      <tr>
        <td>Island Trading</td>
        <td>Helen Bennett</td>
        <td>UK</td>
      </tr>

    </table>
  </div>
</div>

<script>

  //better way to get the type of object
  var toType = function(obj) {
    return ({}).toString.call(obj).match(/\s([a-zA-Z]+)/)[1].toLowerCase()
  }

  var highlightedIDs = [];

  function alertthis(unique_id, wikidata_result) {
    //Not the best way of doing this
    //https://stackoverflow.com/questions/5786851/define-global-variable-in-a-javascript-function
    window.uniqueID = unique_id;
    //highlightedIDs.push(unique_id);

    if (wikidata_result != "None") {
      var json = JSON.parse(wikidata_result);
      var w = json['w'];
      console.log(toType(w));
      var myTable= "<table><tr><td style='width: 100px; color: red;'>Col Head 1</td>";
      myTable+= "<td style='width: 100px; color: red; text-align: right;'>Col Head 2</td>";
      myTable+="<td style='width: 100px; color: red; text-align: right;'>Col Head 3</td></tr>";

      myTable+="<tr><td style='width: 100px;                   '>---------------</td>";
      myTable+="<td     style='width: 100px; text-align: right;'>---------------</td>";
      myTable+="<td     style='width: 100px; text-align: right;'>---------------</td></tr>";

      for (var key in w){
        var attrName = key;
        var attrValue = w[key];
        //console.log(attrValue);
      }

    var modal = document.getElementById("foo");
    modal.style.display = "block";

    var span = document.getElementById("span");
    span.onclick = function () {
      modal.style.display = "none";
    }

    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
    return;
  }

  function highlightToken() {
    document.getElementById(uniqueID).style.color = 'blue';
    highlightedIDs.push(uniqueID);
    //document.getElementById("placeholder").innerHTML += uniqueID;
    console.log(highlightedIDs);
    updateData();
    return;
  }

  function unHighlightToken() {
    var index = highlightedIDs.indexOf(uniqueID);
    if (index > -1) {
      highlightedIDs.splice(index, 1);
      document.getElementById(uniqueID).style.color = 'black';
    }
    console.log(highlightedIDs);
    updateData();
    return
  }

  function updateData(){
    //TODO
    document.getElementById("test").innerHTML = highlightedIDs;
    return;
  }

  // AJAX for posting
  function create_post() {
      console.log("create post is working!") // sanity check
      var data_dict = { the_post : $('#post-text').val(), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'valuepass':42 };
      $.ajax({
          url : "file_upload/", // the endpoint
          type : "POST", // http method
          data : data_dict, // data sent with the post request

          // handle a successful response
          success : function(json) {
              $('#post-text').val(''); // remove the value from the input
              console.log(json); // log the returned json to the console
              console.log("success"); // another sanity check
          },

          // handle a non-successful response
          error : function(xhr,errmsg,err) {
              $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+errmsg+
                  " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
              console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
          }
      });
  };

  $('#post-form').on('submit', function(event){
    event.preventDefault();
    console.log('form submitted');
    create_post();
  });

</script>


{% for Line in TexFile.body %}
    <div>
        {% for Token in Line %}
          {% if not Token.content == None %}
            <span
              class="inline"
              id="{{ Token.unique_id }}"
              style="color: {{ Token.highlight }};"
              onclick="alertthis('{{ Token.unique_id }}', '{{ Token.wikidata_result|escapejs }}')"
            >
                {{ Token.content }}
            </span>
          {% endif %}
          {% if Token.endline %}
              </br>
          {% endif %}
        {% endfor %}
    </div>
{% endfor %}

</body>
</html>
